FROM nvidia/cuda:12.2.0-runtime-ubuntu20.04

# Ubuntu 20.04 ships Python 3.8. Install distro Python + pip.
RUN apt-get update && apt-get install -y --no-install-recommends \
    python3 python3-dev python3-pip ca-certificates \
 && rm -rf /var/lib/apt/lists/* \
 && ln -sf /usr/bin/python3 /usr/bin/python \
 && ln -sf /usr/bin/pip3 /usr/bin/pip

ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PYTHONPATH=/app

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8052
CMD ["python", "-m", "src.agents.main"]
